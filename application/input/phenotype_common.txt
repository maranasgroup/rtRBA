* Parameters define in this file will overwrite ones define in GAMS runRBA.gms file
* check runRBA_GAMS_settings.txt for additional settings (e.g., file paths)

* included in model-version-settings:
* NGAM (N-lim and C-lim chemostats using glucose)
* max_allowed_mito_proteome_allo_fraction
* nonmodeled_proteome_allocation
$include %gms_path%model-version-settings.txt

* Substrate and oxygenation
v_sm.fx('EX_glc__D_e') = 0;
* MFA o2 uptake (mu=0.38) = ~15; o2 uptake at glc uptake of 10, maximizing growth (mu=0.8 for GSM model) = ~26
*v_sm.lo('EX_o2_e') = -15.9684414 * %nscale%;
v_sm.lo('EX_o2_e') = -26.25403530509562 * %nscale%;
v_sm.up('EX_o2_e') = 0 * %nscale%;

* Turn off forming incomplete functional enzyme (to prevent cheap incomplete complex from being formed)
*$include ./incomplete_enzyme_complex_off.txt

* force relative abundances of proteins to match kapp calculations
* If needed, could also try forcing PROWASTE to match, since it's off by default
$setGlobal prosynSlackAllow 1e4 * %nscale%
* minProsynSlack = 1 if you want to minimize deviations from the measured proteome before finding the highest yields, 
** 0 otherwise
$setGlobal minProsynSlack 1
Parameters
prosyn_for_kapps(j)
*$include "%model_root_path%parameterization/kapp/datasets/Rabinowitz2023_batchGlc_using_MFA_and_scRBA_methods/min_flux_violation/enz_alloc.prosyn_frac_unscaled.txt"
$include "%model_root_path%parameterization/kapp/datasets/Rabinowitz2023_batchGlc_using_MFA_and_scRBA_methods/min_flux_violation/enz_alloc.prosyn_unscaled.txt"
;
Variables prosynSlackSum, prosynSlackUB(j), prosynSlackLB(j)
;
prosynSlackLB.lo(j) = 0; prosynSlackLB.up(j) = inf;
prosynSlackUB.lo(j) = 0; prosynSlackUB.up(j) = inf;

$setGlobal biom_id_default 'BIOSYN-BIODILAERO'
$setGlobal mu_0 0.38
* force relative abundances of proteins to match kapp calculations
*Equations proSynKapp(j); proSynKapp(j)$(prosyn_for_kapps(j) > 0).. v(j) - prosynSlackLB(j) + prosynSlackUB(j) =e= v('%biom_id_default%') * prosyn_for_kapps(j) / (%mu_0%);
*Equations proSynKapp(j); proSynKapp(j)$(prosyn_for_kapps(j) > 0).. v(j) - prosynSlackLB(j) + prosynSlackUB(j) =e= v('%biom_id_default%') * prosyn_for_kapps(j) / (%mu_0% * %nscale%);
*Equations proSynKappUB(j); proSynKappUB(j)$(prosyn_for_kapps(j) > 0).. v(j) - prosynSlackUB(j) =l= v('%biom_id_default%') * prosyn_for_kapps(j) / %mu_0%;
*Equations proSynKappLB(j); proSynKappLB(j)$(prosyn_for_kapps(j) > 0).. v(j) + prosynSlackLB(j) =g= v('%biom_id_default%') * prosyn_for_kapps(j) / %mu_0%;
*Equations proSynKappUB(j); proSynKappUB(j)$(prosyn_for_kapps(j) > 0).. v(j) - prosynSlackUB(j) =l= v('BIOSYN-PROTTOBIO') * prosyn_for_kapps(j);
*Equations proSynKappLB(j); proSynKappLB(j)$(prosyn_for_kapps(j) > 0).. v(j) + prosynSlackLB(j) =g= v('BIOSYN-PROTTOBIO') * prosyn_for_kapps(j);
Equation PSS; PSS.. prosynSlackSum =e= sum(j, prosynSlackLB(j) + prosynSlackUB(j));

* kapp updates
* RT default
$setGlobal default_kapp 44294.70139072111
* SC default
$setGlobal default_kapp 35984.09696387159
* SC default, adjusted to RT's growth rate
$setGlobal default_kapp 35984.09696387159 * 0.38 / 0.367
parameters kapp_backup(j)
$include %model_root_path%parameterization/kapp/datasets/Rabinowitz2023_batchGlc_using_MFA_and_scRBA_methods/kapps_RBA.txt
;

* set kapps of rxns if needed
** here, kapps were chosen by finding the smallest number of rxns that needed their kapps turned on to grow on sucrose and use xylose.
** Where possible, reliance upon rxns/enzymes not found in proteomics data or using the default kapp was minimized, to minimize deviations from in vivo behavior.
set kapps_to_update(j)
/
'RXN-PPNCL2_c_FWD-rt0510'
'RXN-PHEtps_e_FWD-rt5861'
'RXN-GLUtps_e_FWD-rt0594'
'RXN-PROtps_e_FWD-rt4390'
'RXN-METtps_e_FWD-rt5861'
'RXN-LYStps_e_FWD-rt5861'
'RXN-VALtps_e_FWD-rt5861'
'RXN-ARGtps_e_FWD-rt5861'
'RXN-SUCR_e_FWD-rt6458'
'RXN-THRtps_e_FWD-rt5861'
'RXN-HOMOX_m_FWD-COX15ARH1YAH1'
'RXN-INOSTtps_e_FWD-rt4674'
'RXN-FRUtps_e_FWD-rt2707'
'RXN-FRUtps_e_FWD-rt2833'
'RXN-FRUtps_e_FWD-rt3556'
'RXN-FRUtps_e_FWD-rt7817'
'RXN-HEX7_c_FWD-rt3614'
/
;

file log /''/;

* set kapp to default if not found, and to value from end of kapp calculations (i.e., min (isozyme kapps, default kapp)) otherwise
loop(kapps_to_update(j),
	if (kapp(j) eq 0,
		if (kapp_backup(j) eq 0,
			kapp(j) = %default_kapp%;
		else
			kapp(j) = kapp_backup(j);
			put log; put j.tl/; putclose;
			);
		);
	);
